---
name: test-prolong

on:
  - push

jobs:
  test-prolong:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: echo -n SUCCESSFUL > .final_status
      - name: Artifacts Upload
        id: artifacts-upload
        uses: ./
        with:
          url: https://artifacts.scality.net
          user: ${{ secrets.ARTIFACTS_USER }}
          password: ${{ secrets.ARTIFACTS_PASSWORD }}
          source: .final_status
          method: upload
      - name: Artifacts Prolong
        id: artifacts-prolong
        uses: ./
        with:
          url: https://artifacts.scality.net
          user: ${{ secrets.ARTIFACTS_USER }}
          password: ${{ secrets.ARTIFACTS_PASSWORD }}
          name: ${{ steps.artifacts-upload.outputs.name }}
          method: prolong
      - name: Print the artifacts name
        run: |
          echo ${{ steps.artifacts-prolong.outputs.name }}
          echo ${{ steps.artifacts-prolong.outputs.link }}
      - name: Get prolonged artifacts
        run: |
          curl -u ${{ secrets.ARTIFACTS_USER }}:${{ secrets.ARTIFACTS_PASSWORD }} ${{ steps.artifacts-prolong.outputs.link }}/.final_status
